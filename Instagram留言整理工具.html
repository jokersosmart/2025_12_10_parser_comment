<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram ç•™è¨€æ•´ç†å·¥å…·</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .header p { opacity: 0.9; }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .tab:hover { background: #f9fafb; }
        .tab.active { border-bottom-color: #667eea; color: #667eea; }
        
        .tab-content { display: none; padding: 30px; }
        .tab-content.active { display: block; }
        
        .guide-box {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 6px;
        }
        
        .guide-box h3 {
            color: #1e40af;
            margin-bottom: 15px;
        }
        
        .guide-box ol, .guide-box ul {
            margin-left: 20px;
            line-height: 1.8;
        }
        
        .guide-box code {
            background: #dbeafe;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
            margin: 5px;
        }
        
        .btn-primary { background: #667eea; }
        .btn-primary:hover { background: #5568d3; transform: translateY(-2px); }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .btn-info { background: #0ea5e9; }
        .btn-warning { background: #f59e0b; }
        
        .template-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 13px;
            white-space: pre;
            overflow-x: auto;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid;
        }
        
        .alert-success { background: #d1fae5; color: #065f46; border-color: #10b981; }
        .alert-info { background: #dbeafe; color: #1e40af; border-color: #3b82f6; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        thead { background: #f8f9fa; position: sticky; top: 0; }
        th { padding: 12px; text-align: left; font-weight: 600; border-bottom: 2px solid #dee2e6; }
        td { padding: 10px 12px; border-bottom: 1px solid #f1f3f5; }
        tbody tr:hover { background: #f8f9fa; }
        
        .editable { cursor: text; min-height: 20px; }
        .editable:hover { background: #fff3cd; }
        .editable:focus { outline: 2px solid #667eea; background: white; }
        
        .stats {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            flex: 1;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value { font-size: 32px; font-weight: bold; color: #667eea; }
        .stat-label { font-size: 14px; color: #6c757d; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“¸ Instagram ç•™è¨€æ•´ç†å·¥å…·</h1>
            <p>ç°¡å–®ã€å¿«é€Ÿã€ä¸éœ€è¦APIè¨­å®š - ç«‹å³é–‹å§‹æ•´ç†æ‚¨çš„IGç•™è¨€</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">ğŸ“– ä½¿ç”¨èªªæ˜</div>
            <div class="tab" onclick="switchTab(1)">ğŸ“ è²¼ä¸Šç•™è¨€</div>
            <div class="tab" onclick="switchTab(2)">ğŸ“Š æ•´ç†ç·¨è¼¯</div>
        </div>
        
        <!-- Tab 1: ä½¿ç”¨èªªæ˜ -->
        <div class="tab-content active">
            <div class="guide-box">
                <h3>ğŸ¯ å·¥å…·åŠŸèƒ½</h3>
                <ul>
                    <li>æ•´ç†Instagramç•™è¨€è³‡æ–™ï¼ˆä¸éœ€è¦APIæˆ–Tokenï¼‰</li>
                    <li>æ”¯æ´è²¼ä¸Šæˆ–ä¸Šå‚³ç•™è¨€è³‡æ–™</li>
                    <li>ç·šä¸Šç·¨è¼¯ã€æœå°‹ã€åˆ†é¡</li>
                    <li>ä¸€éµåŒ¯å‡ºExcelï¼ˆç¹é«”ä¸­æ–‡ç„¡äº‚ç¢¼ï¼‰</li>
                    <li>å®Œå…¨åœ¨ç€è¦½å™¨åŸ·è¡Œï¼Œè³‡æ–™ä¸å¤–å‚³</li>
                </ul>
            </div>
            
            <div class="guide-box">
                <h3>ğŸ“‹ å¦‚ä½•æ”¶é›†Instagramç•™è¨€ï¼ˆ3ç¨®æ–¹æ³•ï¼‰</h3>
                
                <h4>æ–¹æ³•1: ç¶²é ç‰ˆè¤‡è£½ï¼ˆæ¨è–¦ï¼‰</h4>
                <ol>
                    <li>ç”¨é›»è…¦ç€è¦½å™¨æ‰“é–‹Instagramç¶²é ç‰ˆï¼š<code>instagram.com</code></li>
                    <li>å‰å¾€æ‚¨çš„è²¼æ–‡æˆ–å¸³è™Ÿ</li>
                    <li>é»æ“Šä»»ä¸€è²¼æ–‡æŸ¥çœ‹ç•™è¨€</li>
                    <li>æŒ‰<code>Ctrl+A</code>å…¨é¸ï¼Œ<code>Ctrl+C</code>è¤‡è£½</li>
                    <li>è²¼åˆ°æœ¬å·¥å…·çš„ã€Œè²¼ä¸Šç•™è¨€ã€åˆ†é </li>
                    <li>é»æ“Šã€Œæ™ºèƒ½è§£æã€</li>
                </ol>
                
                <h4>æ–¹æ³•2: æ‰‹æ©ŸAppè¤‡è£½</h4>
                <ol>
                    <li>Instagram Appä¸­æ‰“é–‹è²¼æ–‡</li>
                    <li>é•·æŒ‰ç•™è¨€å¯ä»¥è¤‡è£½</li>
                    <li>æˆ–æˆªåœ–å¾Œç”¨OCRå·¥å…·è½‰æ–‡å­—</li>
                </ol>
                
                <h4>æ–¹æ³•3: ä½¿ç”¨ç€è¦½å™¨æ“´å……å¥—ä»¶ï¼ˆæœ€å¿«ï¼‰</h4>
                <ol>
                    <li>å®‰è£Chromeæ“´å……ï¼šã€ŒIGç•™è¨€åŒ¯å‡ºå·¥å…·ã€ï¼ˆæœå°‹Instagram comment exportï¼‰</li>
                    <li>å‰å¾€è²¼æ–‡é é¢</li>
                    <li>é»æ“Šæ“´å……å¥—ä»¶åœ–ç¤º</li>
                    <li>åŒ¯å‡ºç‚ºCSVæˆ–JSON</li>
                    <li>ä¸Šå‚³åˆ°æœ¬å·¥å…·</li>
                </ol>
            </div>
            
            <div class="guide-box">
                <h3>ğŸ“ æ”¯æ´çš„è³‡æ–™æ ¼å¼</h3>
                <p><strong>æ ¼å¼1: æ¨™æº–CSV</strong></p>
                <div class="template-box">ç•™è¨€è€…,ç•™è¨€å…§å®¹,æ™‚é–“,æŒ‰è®šæ•¸
ç‹å°æ˜,å¾ˆæ£’çš„ç…§ç‰‡,2025-11-18 10:00,5
æå°è¯,å–œæ­¡é€™å€‹é¢¨æ ¼,2025-11-18 11:00,3</div>
                
                <p><strong>æ ¼å¼2: JSON</strong></p>
                <div class="template-box">[
  {"user":"ç‹å°æ˜","comment":"å¾ˆæ£’çš„ç…§ç‰‡","time":"2025-11-18 10:00","likes":5}
]</div>
                
                <p><strong>æ ¼å¼3: ç´”æ–‡å­—ï¼ˆè‡ªå‹•è§£æï¼‰</strong></p>
                <div class="template-box">ç‹å°æ˜
å¾ˆæ£’çš„ç…§ç‰‡
10å°æ™‚å‰
5å€‹è®š

æå°è¯  
å–œæ­¡é€™å€‹é¢¨æ ¼
11å°æ™‚å‰
3å€‹è®š</div>
            </div>
            
            <button class="btn btn-success" onclick="switchTab(1)" style="font-size: 16px; padding: 15px 30px;">
                ğŸš€ é–‹å§‹ä½¿ç”¨
            </button>
        </div>
        
        <!-- Tab 2: è²¼ä¸Šç•™è¨€ -->
        <div class="tab-content">
            <div class="alert alert-info">
                ğŸ’¡ æç¤ºï¼šè¤‡è£½Instagramç•™è¨€å¾Œï¼Œè²¼åˆ°ä¸‹æ–¹æ–‡å­—æ¡†ï¼Œé»æ“Šã€Œæ™ºèƒ½è§£æã€å³å¯è‡ªå‹•æ•´ç†
            </div>
            
            <div style="margin: 20px 0;">
                <button class="btn btn-warning" onclick="loadSample()">âœ¨ è¼‰å…¥ç¯„ä¾‹è³‡æ–™ï¼ˆå¿«é€Ÿé«”é©—ï¼‰</button>
                <button class="btn btn-info" onclick="showTemplate()">ğŸ“‹ é¡¯ç¤ºè²¼ä¸Šæ ¼å¼ç¯„æœ¬</button>
            </div>
            
            <textarea id="pasteArea" placeholder="åœ¨æ­¤è²¼ä¸Šå¾Instagramè¤‡è£½çš„ç•™è¨€è³‡æ–™...

æ”¯æ´æ ¼å¼ï¼š
1. ç›´æ¥å¾IGè¤‡è£½çš„æ–‡å­—
2. CSVæ ¼å¼ï¼ˆç•™è¨€è€…,ç•™è¨€å…§å®¹,æ™‚é–“,æŒ‰è®šæ•¸ï¼‰
3. JSONæ ¼å¼

è²¼ä¸Šå¾Œé»æ“Šä¸‹æ–¹ã€Œæ™ºèƒ½è§£æã€æŒ‰éˆ•"></textarea>
            
            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="smartParse()">ğŸ¤– æ™ºèƒ½è§£æ</button>
                <button class="btn btn-success" onclick="parseCSV()">ğŸ“Š è§£æç‚ºCSV</button>
                <button class="btn btn-info" onclick="parseJSON()">ğŸ”§ è§£æç‚ºJSON</button>
            </div>
            
            <div id="parseResult"></div>
        </div>
        
        <!-- Tab 3: æ•´ç†ç·¨è¼¯ -->
        <div class="tab-content">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">ç¸½ç•™è¨€æ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="selectedCount">0</div>
                    <div class="stat-label">å·²é¸å–</div>
                </div>
            </div>
            
            <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                <input type="text" id="searchBox" placeholder="ğŸ” æœå°‹ç•™è¨€..." 
                    style="flex: 1; min-width: 200px; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px;"
                    onkeyup="filterComments()">
                <button class="btn btn-success" onclick="exportExcel()">ğŸ“¥ åŒ¯å‡ºExcel</button>
                <button class="btn btn-info" onclick="copyAll()">ğŸ“‹ è¤‡è£½å…¨éƒ¨</button>
                <button class="btn btn-warning" onclick="addCustomField()">â• æ–°å¢æ¬„ä½</button>
                <button class="btn" style="background: #ef4444;" onclick="deleteSelected()">ğŸ—‘ï¸ åˆªé™¤é¸å–</button>
            </div>
            
            <div id="tableContainer" style="display: none; overflow-x: auto; border: 1px solid #dee2e6; border-radius: 6px; max-height: 600px; overflow-y: auto;">
                <table id="commentsTable">
                    <thead>
                        <tr>
                            <th width="40"><input type="checkbox" id="selectAll" onchange="toggleAll()"></th>
                            <th width="120">ç•™è¨€è€…</th>
                            <th>ç•™è¨€å…§å®¹</th>
                            <th width="150">æ™‚é–“</th>
                            <th width="80">æŒ‰è®šæ•¸</th>
                            <th width="150">ä¾†æºè²¼æ–‡</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
            </div>
            
            <div id="emptyState" style="text-align: center; padding: 60px 20px; color: #6c757d;">
                <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“</div>
                <h3>é‚„æ²’æœ‰ç•™è¨€è³‡æ–™</h3>
                <p style="margin-top: 10px;">è«‹å‰å¾€ã€Œè²¼ä¸Šç•™è¨€ã€åˆ†é åŒ¯å…¥è³‡æ–™</p>
            </div>
        </div>
    </div>

    <script>
        let comments = [];
        let customFields = [];
        let currentTab = 0;
        
        // Tabåˆ‡æ›
        function switchTab(index) {
            document.querySelectorAll('.tab').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            document.querySelectorAll('.tab-content').forEach((content, i) => {
                content.classList.toggle('active', i === index);
            });
            currentTab = index;
        }
        
        // è¼‰å…¥ç¯„ä¾‹
        function loadSample() {
            const sample = `user123,å¾ˆæ£’çš„ç…§ç‰‡ï¼å€¼å¾—æ”¶è— ğŸ‘,2025-11-18 10:30,25,è²¼æ–‡1
photo_lover,ä½ çš„æ”å½±æŠ€è¡“çœŸçš„å¾ˆå°ˆæ¥­,2025-11-18 11:00,18,è²¼æ–‡1
creative_soul,æ§‹åœ–å’Œå…‰å½±éƒ½è™•ç†å¾—å¾ˆå¥½,2025-11-18 12:15,12,è²¼æ–‡2
amy_chen,Great shot! Love it! ğŸŒŸ,2025-11-18 13:20,32,è²¼æ–‡2
designer_tw,è‰²å½©æ­é…å¾ˆèˆ’æœ,2025-11-18 14:00,9,è²¼æ–‡3
travel_girl,è«‹å•é€™æ˜¯åœ¨å“ªè£¡æ‹çš„ï¼Ÿ,2025-11-18 15:30,7,è²¼æ–‡3
john_lee,Incredible work! ğŸ“¸,2025-11-18 16:00,28,è²¼æ–‡4
local_fan,ä¸€ç›´å¾ˆå–œæ­¡ä½ çš„ä½œå“,2025-11-19 09:00,14,è²¼æ–‡4
photo_student,å¯ä»¥åˆ†äº«å¾Œè£½æŠ€å·§å—ï¼Ÿ,2025-11-19 10:00,6,è²¼æ–‡5
art_lover,æ¯æ¬¡éƒ½èƒ½å¸¶ä¾†é©šå–œ,2025-11-19 11:00,22,è²¼æ–‡5`;
            
            document.getElementById('pasteArea').value = sample;
            parseCSV();
            switchTab(2);
        }
        
        // é¡¯ç¤ºç¯„æœ¬
        function showTemplate() {
            alert(`è²¼ä¸Šæ ¼å¼ç¯„æœ¬ï¼š

æ ¼å¼1 - CSVï¼ˆæ¨è–¦ï¼‰ï¼š
ç•™è¨€è€…,ç•™è¨€å…§å®¹,æ™‚é–“,æŒ‰è®šæ•¸,è²¼æ–‡
user1,ç•™è¨€å…§å®¹...,2025-11-18 10:00,5,è²¼æ–‡1
user2,å¦ä¸€å‰‡ç•™è¨€...,2025-11-18 11:00,3,è²¼æ–‡1

æ ¼å¼2 - Tabåˆ†éš”ï¼ˆå¾Excelè¤‡è£½ï¼‰ï¼š
ç•™è¨€è€…	ç•™è¨€å…§å®¹	æ™‚é–“	æŒ‰è®šæ•¸
user1	ç•™è¨€å…§å®¹...	2025-11-18 10:00	5

æ ¼å¼3 - JSONï¼š
[{"user":"user1","content":"ç•™è¨€...","time":"2025-11-18 10:00","likes":5}]

ç›´æ¥è²¼ä¸Šï¼Œå·¥å…·æœƒè‡ªå‹•è­˜åˆ¥æ ¼å¼ï¼`);
        }
        
        // æ™ºèƒ½è§£æ
        function smartParse() {
            const text = document.getElementById('pasteArea').value.trim();
            if (!text) {
                alert('è«‹å…ˆè²¼ä¸Šç•™è¨€è³‡æ–™');
                return;
            }
            
            // å˜—è©¦JSON
            try {
                JSON.parse(text);
                parseJSON();
                return;
            } catch (e) {}
            
            // å˜—è©¦CSV
            if (text.includes(',') || text.includes('\t')) {
                parseCSV();
                return;
            }
            
            // ç´”æ–‡å­—è§£æ
            parseText();
        }
        
        // è§£æCSV
        function parseCSV() {
            const text = document.getElementById('pasteArea').value.trim();
            const lines = text.split('\n').filter(l => l.trim());
            
            // æª¢æŸ¥æ˜¯å¦æœ‰æ¨™é¡Œåˆ—
            const hasHeader = lines[0].includes('ç•™è¨€è€…') || lines[0].includes('user') || lines[0].includes('commenter');
            const startIndex = hasHeader ? 1 : 0;
            
            const separator = text.includes('\t') ? '\t' : ',';
            
            comments = lines.slice(startIndex).map((line, index) => {
                const parts = line.split(separator).map(p => p.trim());
                return {
                    id: Date.now() + index,
                    user: parts[0] || 'æœªçŸ¥',
                    content: parts[1] || '',
                    time: parts[2] || new Date().toLocaleString('zh-TW'),
                    likes: parseInt(parts[3]) || 0,
                    source: parts[4] || 'æœªåˆ†é¡',
                    selected: false,
                    customFields: {}
                };
            });
            
            showSuccess(`âœ… æˆåŠŸè§£æ ${comments.length} å‰‡ç•™è¨€`);
            renderTable();
            switchTab(2);
            save();
        }
        
        // è§£æJSON
        function parseJSON() {
            try {
                const text = document.getElementById('pasteArea').value.trim();
                const data = JSON.parse(text);
                
                comments = data.map((item, index) => ({
                    id: Date.now() + index,
                    user: item.user || item.username || item.commenter || 'æœªçŸ¥',
                    content: item.content || item.comment || item.text || item.message || '',
                    time: item.time || item.timestamp || item.date || new Date().toLocaleString('zh-TW'),
                    likes: parseInt(item.likes || item.like_count || 0),
                    source: item.source || item.post || 'æœªåˆ†é¡',
                    selected: false,
                    customFields: {}
                }));
                
                showSuccess(`âœ… æˆåŠŸè§£æ ${comments.length} å‰‡ç•™è¨€ï¼ˆJSONæ ¼å¼ï¼‰`);
                renderTable();
                switchTab(2);
                save();
            } catch (e) {
                alert('JSONæ ¼å¼éŒ¯èª¤ï¼š' + e.message);
            }
        }
        
        // è§£æç´”æ–‡å­—
        function parseText() {
            const text = document.getElementById('pasteArea').value.trim();
            const blocks = text.split('\n\n').filter(b => b.trim());
            
            comments = blocks.map((block, index) => {
                const lines = block.split('\n').map(l => l.trim());
                return {
                    id: Date.now() + index,
                    user: lines[0] || 'æœªçŸ¥',
                    content: lines[1] || block,
                    time: lines[2] || new Date().toLocaleString('zh-TW'),
                    likes: 0,
                    source: 'æœªåˆ†é¡',
                    selected: false,
                    customFields: {}
                };
            });
            
            showSuccess(`âœ… è§£æ ${comments.length} å‰‡ç•™è¨€ï¼ˆæ–‡å­—æ ¼å¼ï¼‰`);
            renderTable();
            switchTab(2);
            save();
        }
        
        // æ¸²æŸ“è¡¨æ ¼
        function renderTable(filtered = null) {
            const data = filtered || comments;
            const tbody = document.getElementById('tbody');
            
            if (data.length === 0) {
                document.getElementById('tableContainer').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
                return;
            }
            
            document.getElementById('tableContainer').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';
            
            // ç”Ÿæˆæ¨™é¡Œï¼ˆåŒ…å«è‡ªè¨‚æ¬„ä½ï¼‰
            const thead = document.querySelector('thead tr');
            const baseHeaders = '<th width="40"><input type="checkbox" id="selectAll" onchange="toggleAll()"></th><th width="120">ç•™è¨€è€…</th><th>ç•™è¨€å…§å®¹</th><th width="150">æ™‚é–“</th><th width="80">æŒ‰è®šæ•¸</th><th width="150">ä¾†æºè²¼æ–‡</th>';
            const customHeaders = customFields.map(f => `<th width="120">${f}</th>`).join('');
            thead.innerHTML = baseHeaders + customHeaders;
            
            tbody.innerHTML = data.map((c, i) => {
                const customCells = customFields.map(f => `<td contenteditable class="editable" onblur="updateCustomField(${c.id}, '${f}', this.innerText)">${c.customFields[f] || ''}</td>`).join('');
                
                return `<tr>
                    <td><input type="checkbox" ${c.selected ? 'checked' : ''} onchange="toggleSelect(${c.id})"></td>
                    <td contenteditable class="editable" onblur="update(${c.id}, 'user', this.innerText)">${c.user}</td>
                    <td contenteditable class="editable" onblur="update(${c.id}, 'content', this.innerText)">${c.content}</td>
                    <td contenteditable class="editable" onblur="update(${c.id}, 'time', this.innerText)">${c.time}</td>
                    <td contenteditable class="editable" onblur="update(${c.id}, 'likes', this.innerText)">${c.likes}</td>
                    <td contenteditable class="editable" onblur="update(${c.id}, 'source', this.innerText)">${c.source}</td>
                    ${customCells}
                </tr>`;
            }).join('');
            
            updateStats();
        }
        
        // æ›´æ–°è³‡æ–™
        function update(id, field, value) {
            const c = comments.find(x => x.id === id);
            if (c) {
                c[field] = field === 'likes' ? parseInt(value) || 0 : value;
                save();
                showSuccess('âœ… å·²å„²å­˜', 1000);
            }
        }
        
        function updateCustomField(id, field, value) {
            const c = comments.find(x => x.id === id);
            if (c) {
                c.customFields[field] = value;
                save();
                showSuccess('âœ… å·²å„²å­˜', 1000);
            }
        }
        
        // åˆ‡æ›é¸å–
        function toggleSelect(id) {
            const c = comments.find(x => x.id === id);
            if (c) c.selected = !c.selected;
            updateStats();
        }
        
        function toggleAll() {
            const checked = document.getElementById('selectAll').checked;
            comments.forEach(c => c.selected = checked);
            renderTable();
        }
        
        // åˆªé™¤é¸å–
        function deleteSelected() {
            const count = comments.filter(c => c.selected).length;
            if (count === 0) {
                alert('è«‹å…ˆé¸å–è¦åˆªé™¤çš„ç•™è¨€');
                return;
            }
            
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ ${count} å‰‡ç•™è¨€å—ï¼Ÿ`)) {
                comments = comments.filter(c => !c.selected);
                renderTable();
                save();
                showSuccess(`âœ… å·²åˆªé™¤ ${count} å‰‡ç•™è¨€`);
            }
        }
        
        // æœå°‹ç¯©é¸
        function filterComments() {
            const keyword = document.getElementById('searchBox')?.value.toLowerCase();
            if (!keyword) {
                renderTable();
                return;
            }
            
            const filtered = comments.filter(c => 
                c.content.toLowerCase().includes(keyword) ||
                c.user.toLowerCase().includes(keyword)
            );
            renderTable(filtered);
        }
        
        // æ–°å¢è‡ªè¨‚æ¬„ä½
        function addCustomField() {
            const name = prompt('è«‹è¼¸å…¥æ¬„ä½åç¨±ï¼ˆä¾‹å¦‚ï¼šå®¢æˆ¶é¡å‹ã€å›æ‡‰ç‹€æ…‹ï¼‰ï¼š');
            if (name && !customFields.includes(name)) {
                customFields.push(name);
                renderTable();
                save();
                showSuccess(`âœ… å·²æ–°å¢æ¬„ä½ã€Œ${name}ã€`);
            }
        }
        
        // åŒ¯å‡ºExcel
        function exportExcel() {
            if (comments.length === 0) {
                alert('æ²’æœ‰è³‡æ–™å¯åŒ¯å‡º');
                return;
            }
            
            const exportData = comments.map(c => {
                const base = {
                    'ç•™è¨€è€…': c.user,
                    'ç•™è¨€å…§å®¹': c.content,
                    'æ™‚é–“': c.time,
                    'æŒ‰è®šæ•¸': c.likes,
                    'ä¾†æºè²¼æ–‡': c.source
                };
                
                customFields.forEach(f => {
                    base[f] = c.customFields[f] || '';
                });
                
                return base;
            });
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ç•™è¨€è³‡æ–™');
            
            const timestamp = new Date().toISOString().slice(0,16).replace('T', '_').replace(/:/g, '');
            XLSX.writeFile(wb, `Instagramç•™è¨€æ•´ç†_${timestamp}.xlsx`);
            
            showSuccess('ğŸ“¥ Excelå·²ä¸‹è¼‰');
        }
        
        // è¤‡è£½å…¨éƒ¨
        function copyAll() {
            if (comments.length === 0) {
                alert('æ²’æœ‰è³‡æ–™å¯è¤‡è£½');
                return;
            }
            
            const header = ['ç•™è¨€è€…', 'ç•™è¨€å…§å®¹', 'æ™‚é–“', 'æŒ‰è®šæ•¸', 'ä¾†æºè²¼æ–‡', ...customFields].join('\t');
            const rows = comments.map(c => {
                const base = [c.user, c.content, c.time, c.likes, c.source];
                const custom = customFields.map(f => c.customFields[f] || '');
                return [...base, ...custom].join('\t');
            });
            
            const text = [header, ...rows].join('\n');
            navigator.clipboard.writeText(text);
            showSuccess(`âœ… å·²è¤‡è£½ ${comments.length} å‰‡ç•™è¨€ï¼ˆå¯ç›´æ¥è²¼åˆ°Excelï¼‰`);
        }
        
        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            document.getElementById('totalCount').textContent = comments.length;
            document.getElementById('selectedCount').textContent = comments.filter(c => c.selected).length;
        }
        
        // æç¤ºè¨Šæ¯
        function showSuccess(msg, duration = 2000) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-success';
            alert.textContent = msg;
            alert.style.position = 'fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '9999';
            document.body.appendChild(alert);
            setTimeout(() => alert.remove(), duration);
        }
        
        // å„²å­˜
        function save() {
            localStorage.setItem('comments', JSON.stringify(comments));
            localStorage.setItem('customFields', JSON.stringify(customFields));
        }
        
        // è¼‰å…¥
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('comments');
            const fields = localStorage.getItem('customFields');
            
            if (saved) {
                comments = JSON.parse(saved);
                customFields = JSON.parse(fields || '[]');
                if (comments.length > 0) {
                    renderTable();
                    switchTab(2);
                    showSuccess(`âœ… å·²è¼‰å…¥ ${comments.length} å‰‡ç•™è¨€ï¼ˆä¸Šæ¬¡å·¥ä½œéšæ®µï¼‰`, 3000);
                }
            }
        });
    </script>
</body>
</html>
